#+TITLE:     DB Schema
#+AUTHOR:    Dashamir Hoxha
#+EMAIL:     dashohoxha@gmail.com
#+OPTIONS:   H:3 num:t toc:t \n:nil @:t ::t |:t ^:nil -:t f:t *:t <:t
#+OPTIONS:   TeX:t LaTeX:nil skip:nil d:nil todo:t pri:nil tags:not-in-toc

* DB Schema

  Each verse can have several translations (or suggestions) in each
  language. Each translation can have many votes. Each vote is given
  by a certain user.

  The DB tables and their fields:

  + Chapters :: The chapters of the Quran.
    - chapter_id : tinyint :: Number of chapter (from 1 to 114).
    - verses : smallint :: Number of verses.
    - start : smallint :: Index in the table of verses.
    - name : varchar(20) :: Arabic name of chapter.
    - tname : varchar(20) :: Transliterated name of chapter.

  + Verses :: The verses of the Quran.
    - verse_id : serial :: Verse id.
    - chapter_id : tinyint :: Number of chapter.
    - verse_nr : smallint :: Number of the verse.
    - verse_text : varchar(2500) :: The text of the verse.

  + Translations :: Translations/suggestions of the verses.
	 For each verse there can be translations for different
	 languages, and more than one translation for each language.
    - tguid : char(40) :: Globally Unique ID of the translation,
	 defined as the hash: SHA1(CONCAT(translation,lng,verse_id))
    - verse_id : smallint :: Reference to the id of the l10n string that is
	 translated.
    - lng : varchar(5) :: Language code (en, fr, sq_AL, etc.)
    - translation : varchar(2500) :: The (suggested) translation of
	 the verse.
    - count : tinyint :: Count of votes received so far. This can be
	 counted on the table Votes, but for convenience is stored
	 here as well.
    - umail : varchar(250) :: The email of the user that submitted
         this suggestion.
    - ulng : varchar(5) :: The translation language of the user that
         submitted this suggestion.
    - time : datetime :: Time that the translation was
	 entered into the database.
    - active : boolean :: The active or deleted status of the record.

  + Votes :: Votes for each translation/suggestion.
    - vid : serial :: Internal numeric identifier for a vote.
    - tguid : char(40) :: Reference to the id of the translation
	 which is voted.
    - umail : varchar(250) :: The email of the user that submitted
         this suggestion.
    - ulng : varchar(5) :: The translation language of the user that
         submitted this suggestion.
    - time : datetime :: Timestamp of the voting time.
    - active : boolean :: The active or deleted status of the record.

  + Users :: Users that contribute translations/suggestions/votes.
    - umail : varchar(250) :: The email of the user.
    - ulng : varchar(5) :: The translation language of the user.
    - uid : int :: The numeric identifier of the user.
    - name : varchar(6) :: Username.
    - status : tinyint(4) :: Disabled (0) or active (1).
    - points : int :: Number of points rewarded for his activity.
    - config : varchar(250) :: Serialized configuration variables.


  #+CAPTION:    Tables and their relations.
  #+LABEL:      fig:db_diagram
  #+ATTR_LaTeX: width=13cm
  [[./db_diagram.png]]

  #+CAPTION:    Structure of the DB.
  #+LABEL:      fig:object_diagram_1
  #+ATTR_LaTeX: width=13cm
  [[./object_diagram_1.png]]

  #+CAPTION:    Structure of the DB.
  #+LABEL:      fig:object_diagram_2
  #+ATTR_LaTeX: width=12cm
  [[./object_diagram_2.png]]
